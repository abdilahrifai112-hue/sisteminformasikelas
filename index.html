<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - SIKELAS XI MIPA 1</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <span class="logo-icon">ğŸ“</span>
                    <h2>SIK</h2>
                </div>
                <p class="class-name">XI MIPA 1</p>
            </div>
            <ul class="nav-menu">
                <li class="nav-item"><a href="index.html" class="nav-link active"><span class="nav-icon">ğŸ </span><span class="nav-text">Home</span></a></li>
                <li class="nav-item"><a href="biodata.html" class="nav-link"><span class="nav-icon">ğŸ‘¤</span><span class="nav-text">Profil Saya</span></a></li>
                <li class="nav-item"><a href="struktur.html" class="nav-link"><span class="nav-icon">ğŸ›ï¸</span><span class="nav-text">Struktur</span></a></li>
                <li class="nav-item"><a href="piket.html" class="nav-link"><span class="nav-icon">ğŸ§¹</span><span class="nav-text">Piket</span></a></li>
                <li class="nav-item"><a href="absensi.html" class="nav-link"><span class="nav-icon">ğŸ“‹</span><span class="nav-text">Absensi</span></a></li>
                <li class="nav-item"><a href="nilai.html" class="nav-link"><span class="nav-icon">ğŸ“Š</span><span class="nav-text">Nilai</span></a></li>
            </ul>
            <div class="sidebar-footer">
                <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 12px;">
                    <p>Wali Kelas</p>
                    <p style="color: var(--text-main); font-weight: 500;">Bu Siti Aminah, S.Pd</p>
                    <p style="font-size: 10px; opacity: 0.7;">NISN: 198501282010012009</p>
                </div>
                <button onclick="logoutUser()" style="background: transparent; border: 1px solid #ef4444; color: #ef4444; padding: 12px; border-radius: 8px; cursor: pointer; width: 100%;">ğŸšª Keluar</button>
            </div>
        </nav>
        
        <!-- MAIN CONTENT -->
        <main class="main-content">
            
            <!-- DYNAMIC HERO SECTION -->
            <div class="hero-card">
                <div class="hero-bg-accent"></div>
                <div class="hero-content">
                    <p class="hero-greeting">Halo, Semangat Belajar! ğŸš€</p>
                    <h1 class="hero-title" id="userNameDisplay">Selamat Datang<br>Siswa Berprestasi</h1>
                    <div class="hero-date">
                        <span>ğŸ“…</span> <span id="currentDate">Senin, 17 Desember 2025</span>
                    </div>
                </div>
                
                <!-- STATS (Dynamic) -->
                <div class="hero-stats" id="heroStats">
                    <!-- Populated by JS -->
                </div>
            </div>
            
            <!-- DASHBOARD GRID -->
            <div class="dashboard">
                
                <!-- JADWAL PELAJARAN -->
                <section class="card">
                    <div class="card-header">
                        <h3>ğŸ“… Jadwal Pelajaran</h3>
                    </div>
                    
                    <!-- JS TABS -->
                    <div class="schedule-tabs">
                        <button class="tab-btn active" onclick="showSchedule('senin', this)">Senin</button>
                        <button class="tab-btn" onclick="showSchedule('selasa', this)">Selasa</button>
                        <button class="tab-btn" onclick="showSchedule('rabu', this)">Rabu</button>
                        <button class="tab-btn" onclick="showSchedule('kamis', this)">Kamis</button>
                        <button class="tab-btn" onclick="showSchedule('jumat', this)">Jumat</button>
                    </div>

                    <!-- CONTENT SENIN -->
                    <div id="sched-senin" class="schedule-content">
                        <table class="schedule-table">
                            <thead><tr><th>Jam</th><th>Mapel</th><th>Guru</th></tr></thead>
                            <tbody>
                                <tr><td class="time">07:00</td><td><span class="subject-dot" style="background:#4F46E5;"></span>Matematika</td><td>Pak Ahmad</td></tr>
                                <tr><td class="time">08:30</td><td><span class="subject-dot" style="background:#10B981;"></span>Fisika</td><td>Bu Dewi</td></tr>
                                <tr><td colspan="3" class="break">â˜• Istirahat</td></tr>
                                <tr><td class="time">10:15</td><td><span class="subject-dot" style="background:#F59E0B;"></span>Kimia</td><td>Pak Budi</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- CONTENT SELASA (Hidden by default) -->
                    <div id="sched-selasa" class="schedule-content" style="display:none;">
                        <table class="schedule-table">
                            <thead><tr><th>Jam</th><th>Mapel</th><th>Guru</th></tr></thead>
                            <tbody>
                                <tr><td class="time">07:00</td><td><span class="subject-dot" style="background:#10B981;"></span>Biologi</td><td>Bu Ratna</td></tr>
                                <tr><td class="time">08:30</td><td><span class="subject-dot" style="background:#4F46E5;"></span>Matematika</td><td>Pak Ahmad</td></tr>
                                <tr><td colspan="3" class="break">â˜• Istirahat</td></tr>
                                <tr><td class="time">10:15</td><td><span class="subject-dot" style="background:#3B82F6;"></span>Sejarah</td><td>Pak Joko</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                     <!-- CONTENT RABU -->
                     <div id="sched-rabu" class="schedule-content" style="display:none;">
                        <table class="schedule-table">
                            <thead><tr><th>Jam</th><th>Mapel</th><th>Guru</th></tr></thead>
                            <tbody>
                                <tr><td class="time">07:00</td><td><span class="subject-dot" style="background:#8B5CF6;"></span>B. Inggris</td><td>Bu Linda</td></tr>
                                <tr><td class="time">08:30</td><td><span class="subject-dot" style="background:#F59E0B;"></span>Kimia</td><td>Pak Budi</td></tr>
                                <tr><td colspan="3" class="break">â˜• Istirahat</td></tr>
                                <tr><td class="time">10:15</td><td><span class="subject-dot" style="background:#10B981;"></span>Fisika</td><td>Bu Dewi</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- CONTENT KAMIS -->
                    <div id="sched-kamis" class="schedule-content" style="display:none;">
                        <table class="schedule-table">
                            <thead><tr><th>Jam</th><th>Mapel</th><th>Guru</th></tr></thead>
                            <tbody>
                                <tr><td class="time">07:00</td><td><span class="subject-dot" style="background:#10B981;"></span>Biologi</td><td>Bu Ratna</td></tr>
                                <tr><td class="time">08:30</td><td><span class="subject-dot" style="background:#EC4899;"></span>B. Indo</td><td>Bu Sari</td></tr>
                                <tr><td colspan="3" class="break">â˜• Istirahat</td></tr>
                                <tr><td class="time">10:15</td><td><span class="subject-dot" style="background:#14B8A6;"></span>Geografi</td><td>Pak Doni</td></tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- CONTENT JUMAT -->
                    <div id="sched-jumat" class="schedule-content" style="display:none;">
                        <table class="schedule-table">
                            <thead><tr><th>Jam</th><th>Mapel</th><th>Guru</th></tr></thead>
                            <tbody>
                                <tr><td class="time">07:00</td><td><span class="subject-dot" style="background:#6366F1;"></span>Agama</td><td>Pak Ustad</td></tr>
                                <tr><td class="time">08:30</td><td><span class="subject-dot" style="background:#4F46E5;"></span>Matematika</td><td>Pak Ahmad</td></tr>
                                <tr><td colspan="3" class="break">â˜• Sholat Jumat</td></tr>
                            </tbody>
                        </table>
                    </div>

                </section>
                
                <!-- RANGKING KELAS -->
                <section class="card">
                    <div class="card-header">
                        <h3>ğŸ† Top Siswa</h3>
                    </div>
                    <div class="leaderboard" id="dashboardRankList">
                        <!-- Populated by JS -->
                    </div>
                </section>
            </div>
            
            <!-- QUICK INFO -->
            <div class="quick-info">
                <div class="info-card"><div class="info-icon" style="background:rgba(79, 70, 229, 0.2); color: #818cf8;">ğŸ‘¥</div><div><h4>15</h4><p style="font-size:12px; opacity:0.7;">Siswa</p></div></div>
                <div class="info-card"><div class="info-icon" style="background:rgba(16, 185, 129, 0.2); color: #34d399;">âœ…</div><div><h4>14</h4><p>Hadir</p></div></div>
                <div class="info-card"><div class="info-icon" style="background:rgba(245, 158, 11, 0.2); color: #fbbf24;">ğŸ§¹</div><div><h4>Senin</h4><p>Piket</p></div></div>
            </div>
        </main>
    </div>

    <!-- SCRIPTS -->
    <script src="js/data.js"></script>
    <script>
        // Check Auth on Load
        checkAuth();
        
        // Display User Info & Stats
        const user = getCurrentUser();
        const studentData = getStudents(); // Get all data

        if (user) {
            // 1. GREETING
            if (user.role === 'teacher') {
                 document.getElementById('userNameDisplay').innerHTML = `Selamat Datang<br>Ibu Wali Kelas`;
                 document.querySelector('.hero-greeting').innerText = "Halo, Bu Siti Aminah! ğŸ‘©â€ğŸ«";
            } else {
                 document.getElementById('userNameDisplay').innerHTML = `Selamat Datang<br>${user.name}`;
            }

            // 2. STATS LOGIC
            const statsContainer = document.getElementById('heroStats');
            if (user.role === 'teacher') {
                // Teacher View
                statsContainer.innerHTML = `
                    <div class="stat-item">
                        <span class="stat-val">${studentData.length}</span>
                        <span class="stat-label">Murid Aktif</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-val">24/25</span>
                        <span class="stat-label">Tahun Ajar</span>
                    </div>
                `;
            } else {
                // Student View
                // Calculate own average
                const myData = studentData.find(s => s.id === user.id);
                let myAvg = "0";
                if(myData) {
                    const g = myData.grades;
                    myAvg = ((Number(g.mtk)+Number(g.fis)+Number(g.kim)+Number(g.bio)+Number(g.ind)+Number(g.ing))/6).toFixed(1);
                }

                statsContainer.innerHTML = `
                    <div class="stat-item">
                        <span class="stat-val">${studentData.length}</span>
                        <span class="stat-label">Teman</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-val">${myAvg}</span>
                        <span class="stat-label">Rata-rata</span>
                    </div>
                `;
            }

            // 3. LEADERBOARD LOGIC
            const rankContainer = document.getElementById('dashboardRankList');
            
            // Calculate avgs
            const ranked = studentData.map(s => {
                const g = s.grades;
                const avg = ((Number(g.mtk)+Number(g.fis)+Number(g.kim)+Number(g.bio)+Number(g.ind)+Number(g.ing))/6).toFixed(1);
                return {...s, avg};
            }).sort((a,b) => b.avg - a.avg).slice(0,3);

            ranked.forEach((s, idx) => {
                const div = document.createElement('div');
                div.className = `rank-item rank-${idx+1}`;
                div.innerHTML = `
                    <div class="rank-position">${idx+1}</div>
                    <div class="rank-info">
                        <div class="avatar-small" style="background:${s.color}">${s.avatar}</div>
                        <div class="rank-details">
                            <h4>${s.name}</h4>
                            <p style="font-size:10px; color:var(--text-muted)">NIS: ${s.nis}</p>
                            <p style="font-size:11px">Score: <b>${s.avg}</b></p>
                        </div>
                    </div>
                `;
                rankContainer.appendChild(div);
            });
        }

        // Setup Date
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('currentDate').innerText = new Date().toLocaleDateString('id-ID', options);

        // Schedule Tab Logic
        function showSchedule(day, btn) {
            // Hide all content
            document.querySelectorAll('.schedule-content').forEach(el => el.style.display = 'none');
            // Show selected
            document.getElementById('sched-' + day).style.display = 'block';
            
            // Update active btn
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
    </script>
</body>
</html>
